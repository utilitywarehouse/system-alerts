# PROMETHEUS RULES
# DO NOT REMOVE line above, used in `pre-commit` hook

groups:
  - name: team_detection
    rules:
      # used as: `<metric_with_namespace_label> * on (namespace) group_left
      # (team) uw_namespace_team`
      - record: uw_namespace_team
        expr: sum by (namespace, team) (label_replace(kube_namespace_labels{job="kube-state-metrics"}, "team", "$1", "label_uw_systems_owner", "(system|partner|telco)"))
      # used as: `<metric_with_namespace_label> * on (namespace) group_left (team) uw_namespace_oncall_team`
      - record: uw_namespace_oncall_team
        expr: sum by (namespace, team) (label_replace(kube_namespace_labels{job="kube-state-metrics"}, "team", "$1", "annotation_uw_systems_oncall_team", "(.*)"))
