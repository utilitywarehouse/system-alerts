# PROMETHEUS RULES
# DO NOT REMOVE line above, used in `pre-commit` hook

groups:
  # Collector - Tracing
  - name: otel-collector
    rules:
      - alert: ReceiverRefusedSpans
        expr: rate(otelcol_receiver_refused_spans{kubernetes_namespace="otel"}[5m]) > 0
        for: 5m
        labels:
          team: infra
        annotations:
          summary: "{{ $labels.pod }} collector is refusing trace spans from clients"
      - alert: ProcessorDroppedSpans
        expr: rate(otelcol_processor_dropped_spans{kubernetes_namespace="otel"}[5m]) > 0
        for: 5m
        labels:
          team: infra
        annotations:
          summary: "{{ $labels.pod }} collector is dropping trace spans"
      - alert: ExporterFailedToSendSpans
        expr: rate(otelcol_exporter_send_failed_spans{kubernetes_namespace="otel"}[5m]) > 0
        for: 5m
        labels:
          team: infra
        annotations:
          summary: "{{ $labels.pod }} collector failing to export trace spans"
      - alert: ExporterFailedToEnqueueSpans
        expr: rate(otelcol_exporter_enqueue_failed_spans{kubernetes_namespace="otel"}[5m]) > 0
        for: 5m
        labels:
          team: infra
        annotations:
          summary: "{{ $labels.pod }} collector failing to enqueue trace spans. Check the logs"
